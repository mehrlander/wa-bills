{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wa-bills.example.com/schemas/capital-budget-bill.json",
  "title": "Washington State Capital Budget Bill",
  "description": "Schema for extracted data from Washington State capital budget bills",
  "type": "object",
  "required": ["metadata", "parts", "sections", "projects", "agencies", "accounts", "fiscalImpact"],
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Bill metadata and legislative information",
      "properties": {
        "billId": {
          "type": "string",
          "description": "Short bill identifier (e.g., 'SSB 5195.SL')",
          "example": "SSB 5195.SL"
        },
        "longBillId": {
          "type": "string",
          "description": "Full bill identifier",
          "example": "SUBSTITUTE SENATE BILL 5195"
        },
        "legislature": {
          "type": "string",
          "description": "Legislature number and session",
          "example": "69th Legislature"
        },
        "session": {
          "type": "string",
          "description": "Legislative session",
          "example": "2025 Regular Session"
        },
        "sponsors": {
          "type": "string",
          "description": "Bill sponsors"
        },
        "description": {
          "type": "string",
          "description": "Brief description of the bill"
        },
        "billType": {
          "type": "string",
          "description": "Type of bill",
          "enum": ["bill", "sl", "resolution"]
        },
        "readDate": {
          "type": "string",
          "description": "Date of first reading"
        },
        "chapterLaw": {
          "type": "string",
          "description": "Chapter law number when enacted",
          "example": "414"
        },
        "vetoAction": {
          "type": "string",
          "description": "Veto action taken (if any)",
          "example": "(partial veto)"
        },
        "sessionLawCaption": {
          "type": "string",
          "description": "Caption for session law",
          "example": "CAPITAL BUDGET"
        },
        "effectiveDate": {
          "type": "string",
          "description": "Effective date of the bill"
        },
        "passage": {
          "type": "array",
          "description": "Passage information by chamber",
          "items": {
            "type": "object",
            "properties": {
              "chamber": {
                "type": "string",
                "enum": ["s", "h"],
                "description": "Chamber (s=Senate, h=House)"
              },
              "date": {
                "type": "string",
                "description": "Date of passage"
              },
              "yeas": {
                "type": "integer",
                "description": "Number of yea votes"
              },
              "nays": {
                "type": "integer",
                "description": "Number of nay votes"
              },
              "signer": {
                "type": "string",
                "description": "Chamber leader who signed"
              }
            }
          }
        },
        "certifier": {
          "type": ["object", "null"],
          "description": "Person who certified the bill",
          "properties": {
            "name": {
              "type": "string"
            },
            "position": {
              "type": "string"
            }
          }
        },
        "approvedDate": {
          "type": "string",
          "description": "Date approved by governor"
        },
        "filedDate": {
          "type": "string",
          "description": "Date filed with Secretary of State"
        },
        "governor": {
          "type": "string",
          "description": "Governor who signed the bill"
        }
      }
    },
    "parts": {
      "type": "array",
      "description": "Major parts/divisions of the bill",
      "items": {
        "type": "object",
        "properties": {
          "partNumber": {
            "type": "integer",
            "description": "Part number (1-8)"
          },
          "partName": {
            "type": "string",
            "description": "Name/description of the part",
            "examples": ["PART 1 - GENERAL GOVERNMENT", "PART 2 - K-12 EDUCATION"]
          }
        }
      }
    },
    "sections": {
      "type": "array",
      "description": "All bill sections",
      "items": {
        "type": "object",
        "properties": {
          "sectionNumber": {
            "type": "string",
            "description": "Section number",
            "pattern": "^\\d+$"
          },
          "type": {
            "type": "string",
            "description": "Section type",
            "enum": ["new", "amend", ""]
          },
          "action": {
            "type": "string",
            "description": "Legislative action",
            "enum": ["addsectuncod", "amend", "amenduncod", "remd", "addchap", "repealuncod", "emerg", ""]
          },
          "department": {
            "type": ["object", "null"],
            "description": "Department/agency associated with this section",
            "properties": {
              "name": {
                "type": "string"
              },
              "index": {
                "type": ["string", "null"]
              }
            }
          },
          "projectName": {
            "type": "string",
            "description": "Capital project name (if applicable)"
          },
          "projectId": {
            "type": ["string", "null"],
            "description": "8-digit capital project ID",
            "pattern": "^\\d{8}$"
          },
          "text": {
            "type": "array",
            "description": "Text paragraphs in the section",
            "items": {
              "type": "string"
            }
          }
        }
      }
    },
    "projects": {
      "type": "array",
      "description": "All capital projects with consolidated financial data",
      "items": {
        "type": "object",
        "properties": {
          "projectId": {
            "type": "string",
            "description": "8-digit project identifier",
            "pattern": "^\\d{8}$"
          },
          "projectName": {
            "type": "string",
            "description": "Human-readable project name"
          },
          "sectionNumber": {
            "type": "string",
            "description": "Section number where project is defined"
          },
          "department": {
            "type": "string",
            "description": "Department/agency managing the project"
          },
          "appropriations": {
            "type": "object",
            "description": "Appropriation details by type",
            "properties": {
              "reappropriation": {
                "type": "array",
                "description": "Funds carried over from prior biennium",
                "items": {
                  "$ref": "#/definitions/appropriationItem"
                }
              },
              "appropriation": {
                "type": "array",
                "description": "New funds for current biennium",
                "items": {
                  "$ref": "#/definitions/appropriationItem"
                }
              },
              "biennia": {
                "type": "array",
                "description": "Historical and projected biennial data",
                "items": {
                  "$ref": "#/definitions/appropriationItem"
                }
              }
            }
          },
          "fiscalSummary": {
            "type": "object",
            "description": "Fiscal summary for the project",
            "properties": {
              "currentBiennium": {
                "type": "number",
                "description": "Total new appropriations for current biennium (2025-27)"
              },
              "reappropriation": {
                "type": "number",
                "description": "Total reappropriations from prior biennium"
              },
              "priorBiennia": {
                "type": "number",
                "description": "Actual expenditures from prior biennia"
              },
              "futureBiennia": {
                "type": "number",
                "description": "Projected costs for future biennia (2027-29+)"
              },
              "total": {
                "type": "number",
                "description": "Total project lifecycle cost"
              }
            }
          }
        },
        "required": ["projectId", "projectName", "department", "fiscalSummary"]
      }
    },
    "appropriations": {
      "type": "array",
      "description": "All appropriation elements (granular view)",
      "items": {
        "type": "object",
        "properties": {
          "agency": {
            "type": "string",
            "description": "Agency code (3-digit number)"
          },
          "projectId": {
            "type": "string",
            "description": "Project identifier"
          },
          "type": {
            "type": "string",
            "description": "Appropriation type",
            "enum": ["appropriation", "reappropriation", "biennia", "NewAppropriation"]
          },
          "items": {
            "type": "array",
            "description": "Individual line items",
            "items": {
              "$ref": "#/definitions/appropriationItem"
            }
          },
          "subtotal": {
            "type": ["number", "null"],
            "description": "Subtotal for this appropriation group"
          },
          "total": {
            "type": ["number", "null"],
            "description": "Total for this appropriation group"
          }
        }
      }
    },
    "agencies": {
      "type": "object",
      "description": "All agencies/departments referenced in the bill",
      "properties": {
        "departments": {
          "type": "array",
          "description": "List of department names",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Department name"
              },
              "indexName": {
                "type": ["string", "null"],
                "description": "Index name (if different from department name)"
              }
            }
          }
        },
        "agencyCodes": {
          "type": "array",
          "description": "Sorted list of unique agency codes",
          "items": {
            "type": "string",
            "pattern": "^\\d+$"
          }
        }
      }
    },
    "accounts": {
      "type": "array",
      "description": "All unique account names used for appropriations",
      "items": {
        "type": "string",
        "examples": [
          "State Building Construction Account-State",
          "Climate Commitment Account-State",
          "Ruth LeCocq Kagi Early Learning Facilities Development Account-State"
        ]
      }
    },
    "rcwReferences": {
      "type": "array",
      "description": "All Revised Code of Washington (RCW) citations",
      "items": {
        "type": "string",
        "description": "RCW citation in format ##.##.###",
        "pattern": "^\\d+\\.\\d+\\.\\d+$",
        "example": "43.31.565"
      }
    },
    "fiscalImpact": {
      "type": "object",
      "description": "Overall fiscal impact summary",
      "properties": {
        "totalCurrentBiennium": {
          "type": "number",
          "description": "Total new appropriations across all projects for current biennium"
        },
        "totalReappropriation": {
          "type": "number",
          "description": "Total reappropriations across all projects"
        },
        "totalPriorBiennia": {
          "type": "number",
          "description": "Total prior biennium expenditures"
        },
        "totalFutureBiennia": {
          "type": "number",
          "description": "Total projected future biennium costs"
        },
        "grandTotal": {
          "type": "number",
          "description": "Grand total across all time periods"
        },
        "byAccount": {
          "type": "object",
          "description": "Totals aggregated by account name",
          "additionalProperties": {
            "type": "number"
          }
        },
        "byDepartment": {
          "type": "object",
          "description": "Totals aggregated by department",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "currentBiennium": {
                "type": "number"
              },
              "reappropriation": {
                "type": "number"
              },
              "total": {
                "type": "number"
              },
              "projectCount": {
                "type": "integer"
              }
            }
          }
        },
        "projectCount": {
          "type": "integer",
          "description": "Total number of capital projects"
        }
      }
    },
    "dates": {
      "type": "object",
      "description": "Important dates related to the bill",
      "properties": {
        "effectiveDate": {
          "type": "string"
        },
        "approvedDate": {
          "type": "string"
        },
        "filedDate": {
          "type": "string"
        },
        "readDate": {
          "type": "string"
        },
        "passageDates": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "chamber": {
                "type": "string",
                "enum": ["s", "h"]
              },
              "date": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "vetos": {
      "type": "object",
      "description": "Veto information",
      "properties": {
        "hasVeto": {
          "type": "boolean",
          "description": "Whether the bill has any vetoes"
        },
        "vetoType": {
          "type": "string",
          "description": "Type of veto (e.g., 'partial veto')"
        },
        "vetoedSections": {
          "type": "array",
          "description": "List of vetoed section numbers",
          "items": {
            "type": "string"
          }
        },
        "vetoNotes": {
          "type": "array",
          "description": "Veto notes with explanations",
          "items": {
            "type": "object",
            "properties": {
              "section": {
                "type": "string"
              },
              "text": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "extractedAt": {
      "type": "string",
      "description": "ISO 8601 timestamp of when data was extracted",
      "format": "date-time"
    },
    "sourceFile": {
      "type": "string",
      "description": "Name of the source file"
    },
    "extractorVersion": {
      "type": "string",
      "description": "Version of the extraction tool used"
    }
  },
  "definitions": {
    "appropriationItem": {
      "type": "object",
      "description": "Individual appropriation line item",
      "properties": {
        "account": {
          "type": "string",
          "description": "Account name"
        },
        "amount": {
          "type": "number",
          "description": "Numeric amount in dollars"
        },
        "amountFormatted": {
          "type": "string",
          "description": "Formatted amount string (e.g., '$1,234,567')"
        }
      },
      "required": ["account", "amount", "amountFormatted"]
    }
  }
}
