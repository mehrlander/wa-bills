{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://leg.wa.gov/schemas/bill-data-v1.json",
  "title": "Washington State Bill Data Schema",
  "description": "Schema for structured data extracted from Washington State legislative bills, specifically designed for operating budget bills",
  "type": "object",
  "required": ["summary", "data", "extractedAt", "sourceFile"],
  "properties": {
    "summary": {
      "type": "object",
      "description": "High-level summary of the bill",
      "properties": {
        "billId": {
          "type": "string",
          "description": "Short bill identifier (e.g., 'ESSB 5187.SL')",
          "example": "ESSB 5187.SL"
        },
        "billTitle": {
          "type": "string",
          "description": "Title or caption of the bill",
          "example": "OPERATING BUDGET"
        },
        "session": {
          "type": "string",
          "description": "Legislative session",
          "example": "2023 Regular Session"
        },
        "effectiveDate": {
          "type": "string",
          "description": "Date the law becomes effective",
          "example": "May 16, 2023"
        },
        "totalSections": {
          "type": "integer",
          "description": "Total number of bill sections"
        },
        "totalParts": {
          "type": "integer",
          "description": "Total number of parts in the bill"
        },
        "totalAppropriations": {
          "type": "integer",
          "description": "Total number of appropriation sections"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total dollar amount of all appropriations"
        },
        "hasVetos": {
          "type": "boolean",
          "description": "Whether the bill has partial vetoes"
        },
        "vetoedSectionsCount": {
          "type": "integer",
          "description": "Number of sections that were vetoed"
        }
      }
    },
    "data": {
      "type": "object",
      "description": "Detailed extracted data from the bill",
      "properties": {
        "metadata": {
          "$ref": "#/definitions/Metadata"
        },
        "voting": {
          "$ref": "#/definitions/Voting"
        },
        "certification": {
          "$ref": "#/definitions/Certification"
        },
        "vetos": {
          "$ref": "#/definitions/Vetos"
        },
        "structure": {
          "$ref": "#/definitions/Structure"
        },
        "agencies": {
          "$ref": "#/definitions/Agencies"
        },
        "appropriations": {
          "$ref": "#/definitions/Appropriations"
        },
        "statutoryReferences": {
          "$ref": "#/definitions/StatutoryReferences"
        },
        "dates": {
          "$ref": "#/definitions/Dates"
        },
        "conditions": {
          "$ref": "#/definitions/Conditions"
        },
        "fiscalImpacts": {
          "$ref": "#/definitions/FiscalImpacts"
        }
      }
    },
    "extractedAt": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of when data was extracted"
    },
    "sourceFile": {
      "type": "string",
      "description": "Source filename",
      "example": "5187-S.xml"
    }
  },
  "definitions": {
    "Metadata": {
      "type": "object",
      "description": "Bill metadata including identification and sponsors",
      "properties": {
        "shortBillId": {
          "type": "string",
          "description": "Short bill identifier"
        },
        "longBillId": {
          "type": "string",
          "description": "Full bill identifier"
        },
        "legislature": {
          "type": "string",
          "description": "Legislature number (e.g., '68th Legislature')"
        },
        "session": {
          "type": "string",
          "description": "Legislative session"
        },
        "sponsors": {
          "type": "string",
          "description": "Bill sponsors"
        },
        "briefDescription": {
          "type": "string",
          "description": "Brief description of the bill"
        },
        "billTitle": {
          "type": "string",
          "description": "Full bill title including 'AN ACT Relating to...'"
        },
        "readDate": {
          "type": "string",
          "description": "First reading date"
        },
        "plMessage": {
          "type": "string",
          "description": "Passed Legislature message"
        },
        "plSession": {
          "type": "string",
          "description": "Passed Legislature session"
        }
      }
    },
    "Voting": {
      "type": "array",
      "description": "Voting records from both chambers",
      "items": {
        "type": "object",
        "properties": {
          "chamber": {
            "type": "string",
            "enum": ["Senate", "House"],
            "description": "Legislative chamber"
          },
          "chamberCode": {
            "type": "string",
            "enum": ["s", "h"],
            "description": "Chamber code"
          },
          "passedDate": {
            "type": "string",
            "description": "Date the bill passed this chamber"
          },
          "yeas": {
            "type": "integer",
            "description": "Number of yes votes"
          },
          "nays": {
            "type": "integer",
            "description": "Number of no votes"
          },
          "signer": {
            "type": "string",
            "description": "Name of chamber presiding officer"
          }
        }
      }
    },
    "Certification": {
      "type": "object",
      "description": "Bill certification and enrollment information",
      "properties": {
        "chapterLaw": {
          "type": "string",
          "description": "Chapter number in session laws"
        },
        "year": {
          "type": "string",
          "description": "Year of enactment"
        },
        "vetoAction": {
          "type": "string",
          "description": "Veto action description"
        },
        "sessionLawCaption": {
          "type": "string",
          "description": "Caption for session law"
        },
        "effectiveDate": {
          "type": "string",
          "description": "Date law becomes effective"
        },
        "approvedDate": {
          "type": "string",
          "description": "Date governor approved"
        },
        "filedDate": {
          "type": "string",
          "description": "Date filed with Secretary of State"
        },
        "governor": {
          "type": "string",
          "description": "Governor's name"
        },
        "certifier": {
          "type": "string",
          "description": "Name of certifying official"
        },
        "certifierPosition": {
          "type": "string",
          "description": "Position of certifying official"
        }
      }
    },
    "Vetos": {
      "type": "object",
      "description": "Information about vetoed sections",
      "properties": {
        "hasVetos": {
          "type": "boolean",
          "description": "Whether the bill has any vetoes"
        },
        "vetoedSections": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of vetoed section references"
        },
        "approvalText": {
          "type": "string",
          "description": "Full text of approval with veto notation"
        }
      }
    },
    "Structure": {
      "type": "object",
      "description": "Organizational structure of the bill",
      "properties": {
        "totalParts": {
          "type": "integer",
          "description": "Total number of parts"
        },
        "totalSections": {
          "type": "integer",
          "description": "Total number of sections"
        },
        "parts": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "number": {
                "type": "integer",
                "description": "Part number"
              },
              "name": {
                "type": "string",
                "description": "Part name/title"
              },
              "sectionCount": {
                "type": "integer",
                "description": "Number of sections in this part"
              },
              "sections": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "number": {
                      "type": "string",
                      "description": "Section number"
                    },
                    "departmentIndex": {
                      "type": "string",
                      "description": "Department index code"
                    },
                    "departmentName": {
                      "type": "string",
                      "description": "Department name"
                    },
                    "type": {
                      "type": "string",
                      "description": "Section type (e.g., 'new')"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "Agencies": {
      "type": "array",
      "description": "List of agencies mentioned in the bill",
      "items": {
        "type": "object",
        "properties": {
          "index": {
            "type": "string",
            "description": "Agency index code"
          },
          "name": {
            "type": "string",
            "description": "Agency name"
          },
          "agencyCode": {
            "type": "string",
            "description": "Agency numeric code"
          }
        }
      }
    },
    "Appropriations": {
      "type": "array",
      "description": "All appropriations in the bill",
      "items": {
        "type": "object",
        "properties": {
          "sectionNumber": {
            "type": "string",
            "description": "Bill section number"
          },
          "agencyCode": {
            "type": "string",
            "description": "Agency code"
          },
          "departmentName": {
            "type": "string",
            "description": "Department name"
          },
          "items": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "accountName": {
                  "type": "string",
                  "description": "Account name and fiscal year"
                },
                "amount": {
                  "type": "string",
                  "description": "Dollar amount as string (e.g., '$1,000,000')"
                },
                "numericAmount": {
                  "type": "number",
                  "description": "Numeric value of amount"
                }
              }
            }
          },
          "total": {
            "type": "string",
            "description": "Total appropriation for this section"
          },
          "totalNumeric": {
            "type": "number",
            "description": "Numeric total"
          }
        }
      }
    },
    "StatutoryReferences": {
      "type": "array",
      "description": "List of RCW and chapter references",
      "items": {
        "type": "string"
      }
    },
    "Dates": {
      "type": "object",
      "description": "Key dates in the bill lifecycle and deadlines",
      "properties": {
        "legislative": {
          "type": "object",
          "properties": {
            "readFirst": {
              "type": "string",
              "description": "First reading date"
            },
            "senatePassed": {
              "type": "string",
              "description": "Senate passage date"
            },
            "housePassed": {
              "type": "string",
              "description": "House passage date"
            }
          }
        },
        "executive": {
          "type": "object",
          "properties": {
            "approved": {
              "type": "string",
              "description": "Governor approval date"
            },
            "filed": {
              "type": "string",
              "description": "Filing date"
            },
            "effective": {
              "type": "string",
              "description": "Effective date"
            }
          }
        },
        "deadlines": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "date": {
                "type": "string",
                "description": "Deadline date"
              },
              "context": {
                "type": "string",
                "description": "Context around the deadline"
              }
            }
          }
        }
      }
    },
    "Conditions": {
      "type": "array",
      "description": "Conditions and limitations on appropriations",
      "items": {
        "type": "object",
        "properties": {
          "sectionNumber": {
            "type": "string",
            "description": "Section number"
          },
          "departmentName": {
            "type": "string",
            "description": "Department name"
          },
          "mainText": {
            "type": "string",
            "description": "Main conditions text"
          },
          "subsections": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Subsection conditions"
          }
        }
      }
    },
    "FiscalImpacts": {
      "type": "object",
      "description": "Fiscal impact analysis and aggregations",
      "properties": {
        "totalAppropriations": {
          "type": "number",
          "description": "Total of all appropriations in dollars"
        },
        "byFiscalYear": {
          "type": "object",
          "description": "Breakdown by fiscal year",
          "properties": {
            "FY 2024": {
              "type": "number"
            },
            "FY 2025": {
              "type": "number"
            }
          }
        },
        "byFundSource": {
          "type": "object",
          "description": "Breakdown by fund source (keys are fund names)",
          "additionalProperties": {
            "type": "number"
          }
        },
        "byAgency": {
          "type": "object",
          "description": "Breakdown by agency (keys are agency names)",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "agencyCode": {
                "type": "string"
              },
              "total": {
                "type": "number"
              },
              "items": {
                "type": "array"
              }
            }
          }
        }
      }
    }
  }
}
